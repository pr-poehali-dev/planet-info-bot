"""
Telegram-–±–æ—Ç –ó–µ–º–ª—è–ë–æ—Ç ‚Äî –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –∫–æ–º–∞–Ω–¥—ã.
–ü—Ä–∏–Ω–∏–º–∞–µ—Ç webhook –æ—Ç Telegram –∏ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—ã/–∫–Ω–æ–ø–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
"""
import json
import os
import urllib.request
import urllib.parse


TOKEN = os.environ["TELEGRAM_BOT_TOKEN"]
API = f"https://api.telegram.org/bot{TOKEN}"


def send(chat_id: int, text: str, reply_markup=None):
    payload = {
        "chat_id": chat_id,
        "text": text,
        "parse_mode": "HTML",
    }
    if reply_markup:
        payload["reply_markup"] = json.dumps(reply_markup)
    data = json.dumps(payload).encode()
    req = urllib.request.Request(
        f"{API}/sendMessage",
        data=data,
        headers={"Content-Type": "application/json"},
    )
    urllib.request.urlopen(req)


def main_menu():
    return {
        "inline_keyboard": [
            [
                {"text": "üåø –ë–∏–æ—Å—Ñ–µ—Ä–∞", "callback_data": "section_biosphere"},
                {"text": "üåä –ì–∏–¥—Ä–æ—Å—Ñ–µ—Ä–∞", "callback_data": "section_hydrosphere"},
                {"text": "‚è≥ –ò—Å—Ç–æ—Ä–∏—è", "callback_data": "section_history"},
            ],
            [
                {"text": "üå¨Ô∏è –ê—Ç–º–æ—Å—Ñ–µ—Ä–∞", "callback_data": "section_atmosphere"},
                {"text": "‚õ∞Ô∏è –ì–µ–æ–ª–æ–≥–∏—è", "callback_data": "section_geology"},
                {"text": "üå°Ô∏è –ö–ª–∏–º–∞—Ç", "callback_data": "section_climate"},
            ],
            [
                {"text": "üîç –ü–æ–∏—Å–∫ –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π", "callback_data": "search_mode"},
            ],
        ]
    }


SECTIONS = {
    "biosphere": {
        "title": "üåø –ë–∏–æ—Å—Ñ–µ—Ä–∞",
        "text": (
            "<b>–ë–∏–æ—Å—Ñ–µ—Ä–∞</b> ‚Äî –æ–±–æ–ª–æ—á–∫–∞ –ó–µ–º–ª–∏, –≥–¥–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∂–∏–∑–Ω—å.\n\n"
            "‚Ä¢ –ù–∞ –ó–µ–º–ª–µ –æ–ø–∏—Å–∞–Ω–æ –±–æ–ª–µ–µ <b>8,7 –º–ª–Ω –≤–∏–¥–æ–≤</b> –∂–∏–≤—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–º–æ–≤\n"
            "‚Ä¢ –û–±—â–∞—è –±–∏–æ–º–∞—Å—Å–∞ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç <b>‚âà550 –ì—Ç —É–≥–ª–µ—Ä–æ–¥–∞</b>\n"
            "‚Ä¢ –ì–ª—É–±–æ—á–∞–π—à–∞—è –∂–∏–∑–Ω—å ‚Äî –Ω–∞ <b>12 –∫–º</b> –ø–æ–¥ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å—é –æ–∫–µ–∞–Ω–∞\n"
            "‚Ä¢ –†–∞—Å—Ç–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥—è—Ç <b>~120 –º–ª—Ä–¥ —Ç–æ–Ω–Ω</b> –æ—Ä–≥–∞–Ω–∏–∫–∏ –≤ –≥–æ–¥\n"
            "‚Ä¢ –ë–∏–æ—Å—Ñ–µ—Ä–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –±–æ–ª–µ–µ <b>3,8 –º–∏–ª–ª–∏–∞—Ä–¥–∞ –ª–µ—Ç</b>"
        ),
        "sub": [
            [{"text": "üå± –†–∞—Å—Ç–∏—Ç–µ–ª—å–Ω—ã–π –º–∏—Ä", "callback_data": "bio_plants"}, {"text": "ü¶Å –ñ–∏–≤–æ—Ç–Ω—ã–π –º–∏—Ä", "callback_data": "bio_animals"}],
            [{"text": "ü¶† –ú–∏–∫—Ä–æ–æ—Ä–≥–∞–Ω–∏–∑–º—ã", "callback_data": "bio_micro"}, {"text": "‚ö†Ô∏è –£–≥—Ä–æ–∑—ã –±–∏–æ—Å—Ñ–µ—Ä–µ", "callback_data": "bio_threats"}],
        ],
    },
    "hydrosphere": {
        "title": "üåä –ì–∏–¥—Ä–æ—Å—Ñ–µ—Ä–∞",
        "text": (
            "<b>–ì–∏–¥—Ä–æ—Å—Ñ–µ—Ä–∞</b> ‚Äî –≤–æ–¥–Ω–∞—è –æ–±–æ–ª–æ—á–∫–∞ –ó–µ–º–ª–∏.\n\n"
            "‚Ä¢ <b>97,5%</b> –≤–æ–¥—ã –Ω–∞ –ó–µ–º–ª–µ ‚Äî —Å–æ–ª—ë–Ω–∞—è, –ª–∏—à—å 2,5% ‚Äî –ø—Ä–µ—Å–Ω–∞—è\n"
            "‚Ä¢ –ú–∏—Ä–æ–≤–æ–π –æ–∫–µ–∞–Ω –∑–∞–Ω–∏–º–∞–µ—Ç <b>70,8%</b> –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ –ø–ª–∞–Ω–µ—Ç—ã\n"
            "‚Ä¢ –°—Ä–µ–¥–Ω—è—è –≥–ª—É–±–∏–Ω–∞ –æ–∫–µ–∞–Ω–∞ ‚Äî <b>3 800 –º</b>\n"
            "‚Ä¢ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–ª—É–±–∏–Ω–∞ ‚Äî <b>11 034 –º</b> (–ú–∞—Ä–∏–∞–Ω—Å–∫–∞—è –≤–ø–∞–¥–∏–Ω–∞)\n"
            "‚Ä¢ –í –æ–∫–µ–∞–Ω–∞—Ö —Ä–∞—Å—Ç–≤–æ—Ä–µ–Ω–æ <b>~50 –∫–≤–∏–Ω—Ç–∏–ª—å–æ–Ω–æ–≤ —Ç–æ–Ω–Ω</b> —Å–æ–ª–µ–π"
        ),
        "sub": [
            [{"text": "üåä –ú–∏—Ä–æ–≤–æ–π –æ–∫–µ–∞–Ω", "callback_data": "hydro_ocean"}, {"text": "üßä –õ–µ–¥–Ω–∏–∫–∏", "callback_data": "hydro_glaciers"}],
            [{"text": "üèûÔ∏è –†–µ–∫–∏ –∏ –æ–∑—ë—Ä–∞", "callback_data": "hydro_rivers"}, {"text": "‚ôªÔ∏è –ö—Ä—É–≥–æ–≤–æ—Ä–æ—Ç –≤–æ–¥—ã", "callback_data": "hydro_cycle"}],
        ],
    },
    "history": {
        "title": "‚è≥ –ò—Å—Ç–æ—Ä–∏—è –ó–µ–º–ª–∏",
        "text": (
            "<b>–ò—Å—Ç–æ—Ä–∏—è –ó–µ–º–ª–∏</b> –Ω–∞—Å—á–∏—Ç—ã–≤–∞–µ—Ç ~4,54 –º–∏–ª–ª–∏–∞—Ä–¥–∞ –ª–µ—Ç.\n\n"
            "‚Ä¢ –í–æ–∑—Ä–∞—Å—Ç –ó–µ–º–ª–∏ ‚Äî <b>4,54 ¬± 0,05 –º–ª—Ä–¥ –ª–µ—Ç</b>\n"
            "‚Ä¢ –õ—É–Ω–∞ –æ–±—Ä–∞–∑–æ–≤–∞–ª–∞—Å—å <b>~4,5 –º–ª—Ä–¥ –ª–µ—Ç</b> –Ω–∞–∑–∞–¥ (—Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å –¢–µ–π–µ–π)\n"
            "‚Ä¢ –ü–µ—Ä–≤—ã–µ –æ–¥–Ω–æ–∫–ª–µ—Ç–æ—á–Ω—ã–µ ‚Äî <b>3,8‚Äì3,5 –º–ª—Ä–¥</b> –ª–µ—Ç –Ω–∞–∑–∞–¥\n"
            "‚Ä¢ –ö–∏—Å–ª–æ—Ä–æ–¥–Ω–∞—è —Ä–µ–≤–æ–ª—é—Ü–∏—è ‚Äî <b>2,4 –º–ª—Ä–¥</b> –ª–µ—Ç –Ω–∞–∑–∞–¥\n"
            "‚Ä¢ –≠–ø–æ—Ö–∞ –¥–∏–Ω–æ–∑–∞–≤—Ä–æ–≤ –¥–ª–∏–ª–∞—Å—å <b>186 –º–∏–ª–ª–∏–æ–Ω–æ–≤ –ª–µ—Ç</b>"
        ),
        "sub": [
            [{"text": "üî¨ –ê—Ä—Ö–µ–π –∏ –ü—Ä–æ—Ç–µ—Ä–æ–∑–æ–π", "callback_data": "hist_early"}, {"text": "ü¶ï –≠—Ä–∞ –¥–∏–Ω–æ–∑–∞–≤—Ä–æ–≤", "callback_data": "hist_dino"}],
            [{"text": "‚ùÑÔ∏è –õ–µ–¥–Ω–∏–∫–æ–≤—ã–µ –ø–µ—Ä–∏–æ–¥—ã", "callback_data": "hist_ice"}, {"text": "üë§ –ü–æ—è–≤–ª–µ–Ω–∏–µ —á–µ–ª–æ–≤–µ–∫–∞", "callback_data": "hist_human"}],
        ],
    },
    "atmosphere": {
        "title": "üå¨Ô∏è –ê—Ç–º–æ—Å—Ñ–µ—Ä–∞",
        "text": (
            "<b>–ê—Ç–º–æ—Å—Ñ–µ—Ä–∞</b> ‚Äî –≥–∞–∑–æ–≤–∞—è –æ–±–æ–ª–æ—á–∫–∞ –ó–µ–º–ª–∏ (~10 000 –∫–º).\n\n"
            "‚Ä¢ –°–æ—Å—Ç–∞–≤: <b>78,09% –∞–∑–æ—Ç–∞</b> –∏ <b>20,95% –∫–∏—Å–ª–æ—Ä–æ–¥–∞</b>\n"
            "‚Ä¢ –û–±—â–∞—è –º–∞—Å—Å–∞ ‚Äî <b>5,15 √ó 10¬π‚Å∏ –∫–≥</b>\n"
            "‚Ä¢ –û–∑–æ–Ω–æ–≤—ã–π —Å–ª–æ–π —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω –Ω–∞ <b>15‚Äì35 –∫–º</b>\n"
            "‚Ä¢ –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤ –º–µ–∑–æ—Å—Ñ–µ—Ä–µ –æ–ø—É—Å–∫–∞–µ—Ç—Å—è –¥–æ <b>‚àí90¬∞C</b>\n"
            "‚Ä¢ –í —Ç–µ—Ä–º–æ—Å—Ñ–µ—Ä–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –¥–æ—Å—Ç–∏–≥–∞–µ—Ç <b>+2000¬∞C</b>"
        ),
        "sub": [
            [{"text": "üìä –°–ª–æ–∏ –∞—Ç–º–æ—Å—Ñ–µ—Ä—ã", "callback_data": "atm_layers"}, {"text": "üîµ –û–∑–æ–Ω–æ–≤—ã–π —Å–ª–æ–π", "callback_data": "atm_ozone"}],
            [{"text": "üå°Ô∏è –ü–∞—Ä–Ω–∏–∫–æ–≤—ã–π —ç—Ñ—Ñ–µ–∫—Ç", "callback_data": "atm_greenhouse"}, {"text": "üå™Ô∏è –ü–æ–≥–æ–¥–∞ –∏ –≤–µ—Ç–µ—Ä", "callback_data": "atm_weather"}],
        ],
    },
    "geology": {
        "title": "‚õ∞Ô∏è –ì–µ–æ–ª–æ–≥–∏—è",
        "text": (
            "<b>–ì–µ–æ–ª–æ–≥–∏—è</b> –∏–∑—É—á–∞–µ—Ç —Ç–≤—ë—Ä–¥—É—é –æ–±–æ–ª–æ—á–∫—É –ó–µ–º–ª–∏ ‚Äî –ª–∏—Ç–æ—Å—Ñ–µ—Ä—É.\n\n"
            "‚Ä¢ –ó–µ–º–ª—è —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ <b>–∫–æ—Ä—ã, –º–∞–Ω—Ç–∏–∏, –≤–Ω–µ—à–Ω–µ–≥–æ –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —è–¥—Ä–∞</b>\n"
            "‚Ä¢ –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤ —Ü–µ–Ω—Ç—Ä–µ –ó–µ–º–ª–∏ ‚Äî <b>~6 000¬∞C</b>\n"
            "‚Ä¢ –ú–∞—É–Ω–∞-–ö–µ–∞ –æ—Ç –¥–Ω–∞ –æ–∫–µ–∞–Ω–∞: <b>10 203 –º</b>\n"
            "‚Ä¢ –¢–µ–∫—Ç–æ–Ω–∏—á–µ—Å–∫–∏–µ –ø–ª–∏—Ç—ã –¥–≤–∏–∂—É—Ç—Å—è <b>2‚Äì10 —Å–º/–≥–æ–¥</b>\n"
            "‚Ä¢ –°–∞–º—ã–π —Å—Ç–∞—Ä—ã–π –º–∏–Ω–µ—Ä–∞–ª ‚Äî —Ü–∏—Ä–∫–æ–Ω: <b>4,4 –º–ª—Ä–¥ –ª–µ—Ç</b>"
        ),
        "sub": [
            [{"text": "üî¥ –°—Ç—Ä–æ–µ–Ω–∏–µ –ó–µ–º–ª–∏", "callback_data": "geo_structure"}, {"text": "üó∫Ô∏è –¢–µ–∫—Ç–æ–Ω–∏–∫–∞ –ø–ª–∏—Ç", "callback_data": "geo_plates"}],
            [{"text": "üåã –í—É–ª–∫–∞–Ω–∏–∑–º", "callback_data": "geo_volcanoes"}, {"text": "üì≥ –ó–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏—è", "callback_data": "geo_quakes"}],
        ],
    },
    "climate": {
        "title": "üå°Ô∏è –ö–ª–∏–º–∞—Ç",
        "text": (
            "<b>–ö–ª–∏–º–∞—Ç</b> ‚Äî –º–Ω–æ–≥–æ–ª–µ—Ç–Ω–∏–π —Ä–µ–∂–∏–º –ø–æ–≥–æ–¥—ã –º–µ—Å—Ç–Ω–æ—Å—Ç–∏.\n\n"
            "‚Ä¢ –°—Ä–µ–¥–Ω—è—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ –ó–µ–º–ª–∏ ‚Äî <b>+15¬∞C</b>\n"
            "‚Ä¢ –ú–∞–∫—Å–∏–º—É–º: <b>+56,7¬∞C</b> (–î–æ–ª–∏–Ω–∞ –°–º–µ—Ä—Ç–∏, 1913)\n"
            "‚Ä¢ –ú–∏–Ω–∏–º—É–º: <b>‚àí89,2¬∞C</b> (–ê–Ω—Ç–∞—Ä–∫—Ç–∏–¥–∞, 1983)\n"
            "‚Ä¢ –° 1880 –≥. —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤—ã—Ä–æ—Å–ª–∞ –Ω–∞ <b>‚âà1,1¬∞C</b>\n"
            "‚Ä¢ CO‚ÇÇ –¥–æ—Å—Ç–∏–≥ <b>420 ppm</b> ‚Äî –º–∞–∫—Å–∏–º—É–º –∑–∞ 3 –º–ª–Ω –ª–µ—Ç"
        ),
        "sub": [
            [{"text": "üó∫Ô∏è –ö–ª–∏–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∑–æ–Ω—ã", "callback_data": "cli_zones"}, {"text": "üìà –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–ª–∏–º–∞—Ç–∞", "callback_data": "cli_change"}],
            [{"text": "üåä –¢–µ—á–µ–Ω–∏—è –∏ –∫–ª–∏–º–∞—Ç", "callback_data": "cli_currents"}, {"text": "üìä –ö–ª–∏–º–∞—Ç –≤ —Ü–∏—Ñ—Ä–∞—Ö", "callback_data": "cli_stats"}],
        ],
    },
}

SUB_FACTS = {
    "bio_plants": "üå± <b>–†–∞—Å—Ç–∏—Ç–µ–ª—å–Ω—ã–π –º–∏—Ä</b>\n\n–ù–∞ –ó–µ–º–ª–µ ~<b>390 000 –≤–∏–¥–æ–≤ —Ä–∞—Å—Ç–µ–Ω–∏–π</b>. –õ–µ—Å–∞ –∑–∞–Ω–∏–º–∞—é—Ç ~31% —Å—É—à–∏ –∏ –ø–æ–≥–ª–æ—â–∞—é—Ç <b>2,6 –º–ª—Ä–¥ —Ç–æ–Ω–Ω CO‚ÇÇ</b> –µ–∂–µ–≥–æ–¥–Ω–æ. –°–∞–º–æ–µ —Å—Ç–∞—Ä–æ–µ –¥–µ—Ä–µ–≤–æ ‚Äî —Å–æ—Å–Ω–∞ –ú–∞—Ñ—É—Å–∞–∏–ª: <b>4 855 –ª–µ—Ç</b>.",
    "bio_animals": "ü¶Å <b>–ñ–∏–≤–æ—Ç–Ω—ã–π –º–∏—Ä</b>\n\n–û–ø–∏—Å–∞–Ω–æ –±–æ–ª–µ–µ <b>1 –º–ª–Ω –≤–∏–¥–æ–≤ –∂–∏–≤–æ—Ç–Ω—ã—Ö</b>, –∏–∑ –Ω–∏—Ö ~950 —Ç—ã—Å. ‚Äî –Ω–∞—Å–µ–∫–æ–º—ã–µ. –°–∏–Ω–∏–π –∫–∏—Ç ‚Äî –¥–æ <b>33 –º –∏ 190 —Ç–æ–Ω–Ω</b>. –°–æ–∫–æ–ª-—Å–∞–ø—Å–∞–Ω ‚Äî <b>389 –∫–º/—á</b> –≤ –ø–∏–∫–µ.",
    "bio_micro": "ü¶† <b>–ú–∏–∫—Ä–æ–æ—Ä–≥–∞–Ω–∏–∑–º—ã</b>\n\n–ù–∞ –ó–µ–º–ª–µ ~<b>10¬≥‚Å∞ –±–∞–∫—Ç–µ—Ä–∏–π</b> ‚Äî –∏—Ö –º–∞—Å—Å–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –º–∞—Å—Å—É –≤—Å–µ—Ö —Ä–∞—Å—Ç–µ–Ω–∏–π –∏ –∂–∏–≤–æ—Ç–Ω—ã—Ö. –í –æ–¥–Ω–æ–º –≥—Ä–∞–º–º–µ –ø–æ—á–≤—ã ‚Äî –¥–æ <b>1 –º–∏–ª–ª–∏–∞—Ä–¥–∞</b> –±–∞–∫—Ç–µ—Ä–∏–π.",
    "bio_threats": "‚ö†Ô∏è <b>–£–≥—Ä–æ–∑—ã –±–∏–æ—Å—Ñ–µ—Ä–µ</b>\n\n–¢–µ–º–ø—ã –≤—ã–º–∏—Ä–∞–Ω–∏—è –≤–∏–¥–æ–≤ –≤ <b>1 000 —Ä–∞–∑</b> –≤—ã—à–µ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Ñ–æ–Ω–∞. –ß–µ–ª–æ–≤–µ—á–µ—Å—Ç–≤–æ —É–Ω–∏—á—Ç–æ–∂–∏–ª–æ <b>83% –¥–∏–∫–æ–π —Ñ–∞—É–Ω—ã</b>. –ü–ª–æ—â–∞–¥—å –ª–µ—Å–æ–≤ —Å–æ–∫—Ä–∞—Ç–∏–ª–∞—Å—å –Ω–∞ <b>46%</b>.",
    "hydro_ocean": "üåä <b>–ú–∏—Ä–æ–≤–æ–π –æ–∫–µ–∞–Ω</b>\n\n–¢–∏—Ö–∏–π –æ–∫–µ–∞–Ω ‚Äî <b>165,2 –º–ª–Ω –∫–º¬≤</b> (–±–æ–ª—å—à–µ –≤—Å–µ—Ö –∫–æ–Ω—Ç–∏–Ω–µ–Ω—Ç–æ–≤ –≤–º–µ—Å—Ç–µ). –ê—Ç–ª–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è –Ω–∞ <b>1,5 —Å–º/–≥–æ–¥</b>. –ò–∑—É—á–µ–Ω–æ –ª–∏—à—å <b>5‚Äì20%</b> –¥–Ω–∞.",
    "hydro_glaciers": "üßä <b>–õ–µ–¥–Ω–∏–∫–∏</b>\n\n–õ–µ–¥–Ω–∏–∫–∏ —Ö—Ä–∞–Ω—è—Ç <b>69%</b> –ø—Ä–µ—Å–Ω–æ–π –≤–æ–¥—ã –ó–µ–º–ª–∏. –ê–Ω—Ç–∞—Ä–∫—Ç–∏—á–µ—Å–∫–∏–π —â–∏—Ç ‚Äî –ª—ë–¥ —Ç–æ–ª—â–∏–Ω–æ–π –¥–æ <b>4 776 –º</b>. –ü—Ä–∏ –ø–æ–ª–Ω–æ–º —Ç–∞—è–Ω–∏–∏ –æ–∫–µ–∞–Ω –ø–æ–¥–Ω–∏–º–µ—Ç—Å—è –Ω–∞ <b>65‚Äì70 –º</b>.",
    "hydro_rivers": "üèûÔ∏è <b>–†–µ–∫–∏ –∏ –æ–∑—ë—Ä–∞</b>\n\n–°–∞–º–∞—è –¥–ª–∏–Ω–Ω–∞—è ‚Äî <b>–ù–∏–ª (6 853 –∫–º)</b>. –°–∞–º–∞—è –ø–æ–ª–Ω–æ–≤–æ–¥–Ω–∞—è ‚Äî <b>–ê–º–∞–∑–æ–Ω–∫–∞</b> (20% –≤—Å–µ–π —Ä–µ—á–Ω–æ–π –≤–æ–¥—ã –ó–µ–º–ª–∏). –ë–∞–π–∫–∞–ª ‚Äî <b>1 642 –º</b> –≥–ª—É–±–∏–Ω—ã –∏ <b>20%</b> –º–∏—Ä–æ–≤—ã—Ö –∑–∞–ø–∞—Å–æ–≤ –ø—Ä–µ—Å–Ω–æ–π –≤–æ–¥—ã.",
    "hydro_cycle": "‚ôªÔ∏è <b>–ö—Ä—É–≥–æ–≤–æ—Ä–æ—Ç –≤–æ–¥—ã</b>\n\n–ï–∂–µ–≥–æ–¥–Ω–æ –∏—Å–ø–∞—Ä—è–µ—Ç—Å—è <b>~577 000 –∫–º¬≥</b> –≤–æ–¥—ã. –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –≤ –∞—Ç–º–æ—Å—Ñ–µ—Ä–µ ‚Äî <b>8‚Äì10 –¥–Ω–µ–π</b>. –ü–æ–¥–∑–µ–º–Ω—ã–µ –≤–æ–¥—ã ‚Äî <b>30%</b> –ø—Ä–µ—Å–Ω–æ–π –≤–æ–¥—ã, —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è —Ç—ã—Å—è—á–µ–ª–µ—Ç–∏—è–º–∏.",
    "hist_early": "üî¨ <b>–ê—Ä—Ö–µ–π –∏ –ü—Ä–æ—Ç–µ—Ä–æ–∑–æ–π</b>\n\n–ê—Ä—Ö–µ–π (4‚Äì2,5 –º–ª—Ä–¥ –ª–µ—Ç) ‚Äî —ç–ø–æ—Ö–∞ –ø–µ—Ä–≤—ã—Ö –ø—Ä–æ–∫–∞—Ä–∏–æ—Ç. –ü—Ä–æ—Ç–µ—Ä–æ–∑–æ–π (2,5‚Äì541 –º–ª–Ω –ª–µ—Ç) ‚Äî –ø–æ—è–≤–ª–µ–Ω–∏–µ —ç—É–∫–∞—Ä–∏–æ—Ç, –º–Ω–æ–≥–æ–∫–ª–µ—Ç–æ—á–Ω—ã—Ö –∏ –∫–∏—Å–ª–æ—Ä–æ–¥–Ω–æ–π –∞—Ç–º–æ—Å—Ñ–µ—Ä—ã.",
    "hist_dino": "ü¶ï <b>–≠—Ä–∞ –¥–∏–Ω–æ–∑–∞–≤—Ä–æ–≤</b>\n\n–ú–µ–∑–æ–∑–æ–π (252‚Äì66 –º–ª–Ω –ª–µ—Ç): —Ç—Ä–∏–∞—Å, —é—Ä–∞, –º–µ–ª. –ê—Ä–≥–µ–Ω—Ç–∏–Ω–æ–∑–∞–≤—Ä ‚Äî –¥–æ <b>40 –º, ~100 —Ç–æ–Ω–Ω</b>. –í—ã–º–∏—Ä–∞–Ω–∏–µ ‚Äî –∞—Å—Ç–µ—Ä–æ–∏–¥ –¥–∏–∞–º–µ—Ç—Ä–æ–º <b>~10 –∫–º</b>.",
    "hist_ice": "‚ùÑÔ∏è <b>–õ–µ–¥–Ω–∏–∫–æ–≤—ã–µ –ø–µ—Ä–∏–æ–¥—ã</b>\n\n–ó–∞ 2,6 –º–ª–Ω –ª–µ—Ç ‚Äî –æ–∫–æ–ª–æ <b>50 –ª–µ–¥–Ω–∏–∫–æ–≤—ã—Ö —Ü–∏–∫–ª–æ–≤</b>. –ü–æ—Å–ª–µ–¥–Ω–∏–π –º–∞–∫—Å–∏–º—É–º ‚Äî <b>21 000 –ª–µ—Ç –Ω–∞–∑–∞–¥</b>. –õ–µ–¥–Ω–∏–∫–∏ –ø–æ–∫—Ä—ã–≤–∞–ª–∏ <b>30% —Å—É—à–∏</b>.",
    "hist_human": "üë§ <b>–ü–æ—è–≤–ª–µ–Ω–∏–µ —á–µ–ª–æ–≤–µ–∫–∞</b>\n\nHomo sapiens –ø–æ—è–≤–∏–ª—Å—è –≤ –ê—Ñ—Ä–∏–∫–µ <b>~300 000 –ª–µ—Ç –Ω–∞–∑–∞–¥</b>. –†–∞—Å—Å–µ–ª–µ–Ω–∏–µ ‚Äî <b>~70 000 –ª–µ—Ç</b> –Ω–∞–∑–∞–¥. –ü–µ—Ä–≤—ã–µ –≥–æ—Ä–æ–¥–∞ ‚Äî <b>~5 500 –ª–µ—Ç</b> –Ω–∞–∑–∞–¥.",
    "atm_layers": "üìä <b>–°–ª–æ–∏ –∞—Ç–º–æ—Å—Ñ–µ—Ä—ã</b>\n\n–¢—Ä–æ–ø–æ—Å—Ñ–µ—Ä–∞ (0‚Äì12 –∫–º) ‚Äî –ø–æ–≥–æ–¥–∞, <b>80% –º–∞—Å—Å—ã</b>. –°—Ç—Ä–∞—Ç–æ—Å—Ñ–µ—Ä–∞ (12‚Äì50 –∫–º) ‚Äî –æ–∑–æ–Ω. –ú–µ–∑–æ—Å—Ñ–µ—Ä–∞ (50‚Äì85 –∫–º) ‚Äî –º–µ—Ç–µ–æ—Ä–∏—Ç—ã. –¢–µ—Ä–º–æ—Å—Ñ–µ—Ä–∞ ‚Äî –ø–æ–ª—è—Ä–Ω–æ–µ —Å–∏—è–Ω–∏–µ.",
    "atm_ozone": "üîµ <b>–û–∑–æ–Ω–æ–≤—ã–π —Å–ª–æ–π</b>\n\n–ü–æ–≥–ª–æ—â–∞–µ—Ç <b>97‚Äì99%</b> —É–ª—å—Ç—Ä–∞—Ñ–∏–æ–ª–µ—Ç–∞ –°–æ–ª–Ω—Ü–∞. –ú–∞–∫—Å–∏–º—É–º ¬´–¥—ã—Ä—ã¬ª ‚Äî <b>2000 –≥.</b> (29,9 –º–ª–Ω –∫–º¬≤). –ë–ª–∞–≥–æ–¥–∞—Ä—è –ú–æ–Ω—Ä–µ–∞–ª—å—Å–∫–æ–º—É –ø—Ä–æ—Ç–æ–∫–æ–ª—É 1987 –≥. —Å–ª–æ–π –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è.",
    "atm_greenhouse": "üå°Ô∏è <b>–ü–∞—Ä–Ω–∏–∫–æ–≤—ã–π —ç—Ñ—Ñ–µ–∫—Ç</b>\n\n–ë–µ–∑ –Ω–µ–≥–æ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –ó–µ–º–ª–∏ –±—ã–ª–∞ –±—ã <b>‚àí18¬∞C</b> –≤–º–µ—Å—Ç–æ +15¬∞C. –û—Å–Ω–æ–≤–Ω—ã–µ –≥–∞–∑—ã: –≤–æ–¥—è–Ω–æ–π –ø–∞—Ä (50%), CO‚ÇÇ (20%), –æ–∑–æ–Ω (7%), –º–µ—Ç–∞–Ω.",
    "atm_weather": "üå™Ô∏è <b>–ü–æ–≥–æ–¥–∞ –∏ –≤–µ—Ç–µ—Ä</b>\n\n–†–µ–∫–æ—Ä–¥ –≤–µ—Ç—Ä–∞ ‚Äî <b>372 –∫–º/—á</b> (–≥. –í–∞—à–∏–Ω–≥—Ç–æ–Ω, 1934). –£—Ä–∞–≥–∞–Ω 5-–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Äî —Å–≤—ã—à–µ <b>250 –∫–º/—á</b>. –ú–æ–ª–Ω–∏—è –Ω–∞–≥—Ä–µ–≤–∞–µ—Ç –≤–æ–∑–¥—É—Ö –¥–æ <b>30 000¬∞C</b>.",
    "geo_structure": "üî¥ <b>–°—Ç—Ä–æ–µ–Ω–∏–µ –ó–µ–º–ª–∏</b>\n\n–ö–æ—Ä–∞: <b>5‚Äì70 –∫–º</b>. –ú–∞–Ω—Ç–∏—è: <b>2 900 –∫–º</b>, 500‚Äì4 000¬∞C. –í–Ω–µ—à–Ω–µ–µ —è–¥—Ä–æ: –∂–∏–¥–∫–æ–µ –∂–µ–ª–µ–∑–æ, <b>2 200 –∫–º</b>. –í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —è–¥—Ä–æ: <b>1 220 –∫–º</b>, ~6 000¬∞C.",
    "geo_plates": "üó∫Ô∏è <b>–¢–µ–∫—Ç–æ–Ω–∏–∫–∞ –ø–ª–∏—Ç</b>\n\n–õ–∏—Ç–æ—Å—Ñ–µ—Ä–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞ <b>7 –∫—Ä—É–ø–Ω—ã—Ö –∏ ~20 –º–∞–ª—ã—Ö</b> –ø–ª–∏—Ç. –ì–∏–º–∞–ª–∞–∏ —Ä–∞—Å—Ç—É—Ç <b>~5 –º–º/–≥–æ–¥</b>. –ê—Ç–ª–∞–Ω—Ç–∏–∫–∞ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è <b>2,5 —Å–º/–≥–æ–¥</b>.",
    "geo_volcanoes": "üåã <b>–í—É–ª–∫–∞–Ω–∏–∑–º</b>\n\n–û–∫–æ–ª–æ <b>1 500 –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö</b> –≤—É–ª–∫–∞–Ω–æ–≤. –¢–∞–º–±–æ—Ä–∞ (1815) ‚Äî <b>160 –∫–º¬≥</b> –≤—ã–±—Ä–æ—Å–∞. –ï–∂–µ–≥–æ–¥–Ω–æ ‚Äî <b>50‚Äì60 –∏–∑–≤–µ—Ä–∂–µ–Ω–∏–π</b>, 80% ‚Äî –ø–æ–¥–≤–æ–¥–Ω—ã–µ.",
    "geo_quakes": "üì≥ <b>–ó–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏—è</b>\n\n–ï–∂–µ–≥–æ–¥–Ω–æ <b>~500 000</b> –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏–π, ~100 000 –æ—â—É—Ç–∏–º—ã. –ß–∏–ª–∏–π—Å–∫–æ–µ 1960 –≥. ‚Äî –º–∞–≥–Ω–∏—Ç—É–¥–∞ <b>9,5</b>. –ó–æ–Ω–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ ‚Äî –¢–∏—Ö–æ–æ–∫–µ–∞–Ω—Å–∫–æ–µ –æ–≥–Ω–µ–Ω–Ω–æ–µ –∫–æ–ª—å—Ü–æ.",
    "cli_zones": "üó∫Ô∏è <b>–ö–ª–∏–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∑–æ–Ω—ã</b>\n\n–ü–æ –ö—ë–ø–ø–µ–Ω—É: —Ç—Ä–æ–ø–∏—á–µ—Å–∫–∏–π, —Å—É—Ö–æ–π, —É–º–µ—Ä–µ–Ω–Ω—ã–π, –∫–æ–Ω—Ç–∏–Ω–µ–Ω—Ç–∞–ª—å–Ω—ã–π, –ø–æ–ª—è—Ä–Ω—ã–π. –£–º–µ—Ä–µ–Ω–Ω—ã–π ‚Äî —Å–∞–º–∞—è –±–æ–ª—å—à–∞—è –∑–æ–Ω–∞ (<b>~25% —Å—É—à–∏</b>).",
    "cli_change": "üìà <b>–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–ª–∏–º–∞—Ç–∞</b>\n\n–° 1880 –≥. —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤—ã—Ä–æ—Å–ª–∞ –Ω–∞ <b>1,1¬∞C</b>. 2023-–π ‚Äî <b>—Å–∞–º—ã–π –∂–∞—Ä–∫–∏–π</b> –∑–∞ –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é. –ú–ì–≠–ò–ö: —Ä–æ—Å—Ç <b>1,5‚Äì4,5¬∞C</b> –∫ 2100 –≥.",
    "cli_currents": "üåä <b>–¢–µ—á–µ–Ω–∏—è –∏ –∫–ª–∏–º–∞—Ç</b>\n\n–ì–æ–ª—å—Ñ—Å—Ç—Ä–∏–º ‚Äî <b>30 –º–ª–Ω –º¬≥/—Å</b> (–≤ 20 —Ä–∞–∑ –±–æ–ª—å—à–µ –≤—Å–µ—Ö —Ä–µ–∫). –ë–µ–∑ –Ω–µ–≥–æ –ï–≤—Ä–æ–ø–∞ —Ö–æ–ª–æ–¥–Ω–µ–µ –Ω–∞ <b>5‚Äì10¬∞C</b>. –≠–ª—å-–ù–∏–Ω—å–æ –≤–ª–∏—è–µ—Ç –Ω–∞ <b>‚Öì –ø–ª–∞–Ω–µ—Ç—ã</b>.",
    "cli_stats": "üìä <b>–ö–ª–∏–º–∞—Ç –≤ —Ü–∏—Ñ—Ä–∞—Ö</b>\n\n–ú–∞–∫—Å–∏–º—É–º: <b>+56,7¬∞C</b> (–î–æ–ª–∏–Ω–∞ –°–º–µ—Ä—Ç–∏, 1913). –ú–∏–Ω–∏–º—É–º: <b>‚àí89,2¬∞C</b> (–ê–Ω—Ç–∞—Ä–∫—Ç–∏–¥–∞, 1983). –ú–∞—É–∞—Å–∏–Ω—Ä–∞–º ‚Äî <b>11 870 –º–º/–≥–æ–¥</b> –æ—Å–∞–¥–∫–æ–≤.",
}

ALL_SEARCH_DATA = []
for sec_key, sec in SECTIONS.items():
    for line in sec["text"].split("\n"):
        clean = line.replace("<b>", "").replace("</b>", "").strip("‚Ä¢ ")
        if clean:
            ALL_SEARCH_DATA.append({"section": sec["title"], "text": clean})
for sub_key, sub_text in SUB_FACTS.items():
    clean = sub_text.replace("<b>", "").replace("</b>", "")
    ALL_SEARCH_DATA.append({"section": sub_key, "text": clean})

USER_STATES = {}


def handler(event: dict, context) -> dict:
    """
    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ webhook-–∑–∞–ø—Ä–æ—Å—ã –æ—Ç Telegram.
    –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã /start, /help, /search –∏ inline-–∫–Ω–æ–ø–∫–∏.
    """
    if event.get("httpMethod") == "OPTIONS":
        return {
            "statusCode": 200,
            "headers": {
                "Access-Control-Allow-Origin": "*",
                "Access-Control-Allow-Methods": "GET, POST, OPTIONS",
                "Access-Control-Allow-Headers": "Content-Type",
            },
            "body": "",
        }

    if event.get("httpMethod") == "GET":
        return {
            "statusCode": 200,
            "headers": {"Access-Control-Allow-Origin": "*", "Content-Type": "application/json"},
            "body": json.dumps({"status": "ok", "bot": "–ó–µ–º–ª—è–ë–æ—Ç"}),
        }

    body = json.loads(event.get("body") or "{}")

    if "callback_query" in body:
        cq = body["callback_query"]
        chat_id = cq["message"]["chat"]["id"]
        data = cq.get("data", "")
        ack_url = f"{API}/answerCallbackQuery"
        ack_data = json.dumps({"callback_query_id": cq["id"]}).encode()
        ack_req = urllib.request.Request(ack_url, data=ack_data, headers={"Content-Type": "application/json"})
        urllib.request.urlopen(ack_req)

        if data == "back_main":
            send(chat_id, "üåç –í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è:", reply_markup=main_menu())

        elif data == "search_mode":
            USER_STATES[chat_id] = "search"
            send(chat_id, "üîç <b>–ü–æ–∏—Å–∫ –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π</b>\n\n–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ.\n–ü—Ä–∏–º–µ—Ä—ã: ¬´–≤—É–ª–∫–∞–Ω¬ª, ¬´—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞¬ª, ¬´–∫–∏—Ç¬ª, ¬´–ª–µ–¥–Ω–∏–∫¬ª, ¬´–∫–∏—Å–ª–æ—Ä–æ–¥¬ª...")

        elif data.startswith("section_"):
            key = data.replace("section_", "")
            sec = SECTIONS.get(key)
            if sec:
                markup = {"inline_keyboard": sec["sub"] + [[{"text": "‚Üê –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", "callback_data": "back_main"}]]}
                send(chat_id, sec["text"], reply_markup=markup)

        elif data in SUB_FACTS:
            markup = {"inline_keyboard": [[{"text": "‚Üê –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", "callback_data": "back_main"}]]}
            send(chat_id, SUB_FACTS[data], reply_markup=markup)

    elif "message" in body:
        msg = body["message"]
        chat_id = msg["chat"]["id"]
        text = msg.get("text", "").strip()

        if text in ("/start", "/help"):
            USER_STATES.pop(chat_id, None)
            welcome = (
                "üåç <b>–ó–µ–º–ª—è–ë–æ—Ç ‚Äî –ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∞—è —ç–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏—è –ø–ª–∞–Ω–µ—Ç—ã</b>\n\n"
                "–ó–¥–µ—Å—å –≤—ã –Ω–∞–π–¥—ë—Ç–µ –Ω–∞—É—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, —Ñ–∞–∫—Ç—ã –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –æ –ó–µ–º–ª–µ.\n\n"
                "–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è:"
            )
            send(chat_id, welcome, reply_markup=main_menu())

        elif text == "/search":
            USER_STATES[chat_id] = "search"
            send(chat_id, "üîç –í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π:")

        elif USER_STATES.get(chat_id) == "search":
            USER_STATES.pop(chat_id, None)
            q = text.lower()
            results = [d for d in ALL_SEARCH_DATA if q in d["text"].lower()][:5]
            if not results:
                reply = f"–ü–æ –∑–∞–ø—Ä–æ—Å—É ¬´{text}¬ª –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.\n\n–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–µ —Å–ª–æ–≤–æ."
            else:
                lines = "\n\n".join(
                    f"<b>{r['section']}</b>\n{r['text'][:120]}..." for r in results
                )
                reply = f"üîç –ù–∞–π–¥–µ–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: <b>{len(results)}</b>\n\n{lines}"
            markup = {"inline_keyboard": [
                [{"text": "üîç –ù–æ–≤—ã–π –ø–æ–∏—Å–∫", "callback_data": "search_mode"}, {"text": "‚Üê –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", "callback_data": "back_main"}]
            ]}
            send(chat_id, reply, reply_markup=markup)

        else:
            send(chat_id, "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ /start –¥–ª—è –Ω–∞—á–∞–ª–∞.", reply_markup=main_menu())

    return {
        "statusCode": 200,
        "headers": {"Access-Control-Allow-Origin": "*", "Content-Type": "application/json"},
        "body": json.dumps({"ok": True}),
    }
